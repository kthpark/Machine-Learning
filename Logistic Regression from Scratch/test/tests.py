import ast
import re
import numpy as np
import matplotlib.pyplot as plt
from hstest.stage_test import List
from hstest import StageTest, TestCase, CheckResult

# Keys mse_accuracy, logloss_accuracy & sklearn_accuracy link to the exact values that are expected from the student.
# Keys mse_error_first, mse_error_last, logloss_error_first, logloss_error_last link to the errors calculated WITH
# division by number of samples in the train set.
# Since there is more than one possible way to calculate the errors, the test program won't check error values. It will
# check accuracy values and the length of error arrays. Then it will plot the errors from `answer_dict`.

answer_dict = {'mse_accuracy': 0.9649122807017544, 'logloss_accuracy': 0.9649122807017544, 'sklearn_accuracy': 0.9649122807017544, 'mse_error_first': [0.0005494505494505495, 0.0005479411901199512, 0.0005462938918075033, 0.0005483649821435793, 0.0005449777602668188, 0.0005465389968782148, 0.0005461152268424567, 0.0005437657975692605, 0.0005449503977559713, 0.0005332354502691827, 0.0005467009152216291, 0.0005348759703757981, 0.0005418900326760828, 0.0005452116082325752, 0.0005255601479164673, 0.0005410931383673695, 0.0005389752869800741, 0.0005382706459865135, 0.000536001719878404, 0.0005391530380032358, 0.00052861440687876, 0.0005243686477474502, 0.0005194644572302617, 0.0005219008910719626, 0.0005275639876855294, 0.0005294625937561191, 0.0005440733711013254, 0.0005275881241668178, 0.0005305869752658705, 0.0005151368622697822, 0.0004898910124624294, 0.0004935688401495719, 0.0005907817481125807, 0.0005415811438306481, 0.0005292364531546022, 0.000519354029765896, 0.000530048787620448, 0.0005026166871066447, 0.0005040574898543715, 0.00047347902939871617, 0.0005297067576448801, 0.000543443978744388, 0.0005145831618823939, 0.0004905213364624332, 0.0005212440135708726, 0.0005131561900031159, 0.0004765201321226917, 0.0005111320227419458, 0.0005163192825300981, 0.0004610524517004608, 0.00047834855910253756, 0.0004952728333993177, 0.0004650573842722183, 0.0004925849659638627, 0.00047928390386125304, 0.0004914957064813486, 0.0005401043061795428, 0.00045344988904217644, 0.0004580495130451206, 0.0005024606037277136, 0.0005639942542426755, 0.0004879060019912843, 0.00048692489615500265, 0.00048184052150317743, 0.0004843324539732614, 0.0004953191547746046, 0.00035433192263757576, 0.000485173425456471, 0.0004887302889066022, 0.00045841559987281407, 0.00047833432345815004, 0.0004920517548157017, 0.0005401379522774756, 0.00044496148493266234, 0.0005292101267784971, 0.00047249580281645884, 0.00046803301365109075, 0.00040905896075669015, 0.00045240078183608583, 0.000501825599571657, 0.0005182166586603607, 0.0003930559875549771, 0.0005080011773601419, 0.00043714777786576755, 0.0004764651771342405, 0.00048796350839978354, 0.0004914422957405987, 0.0005073628582695488, 0.0004628327545938161, 0.00047661339415538484, 0.0004704301736712522, 0.00034274781128216863, 0.0004640934664821125, 0.00040369471931905155, 0.00033758540589701506, 0.0005483538824952028, 0.0004919354576309312, 0.00043974794160051884, 0.00043524100322905646, 0.00040661779977321105, 0.0005138061670362106, 0.0003874576793676253, 0.00040920505661737956, 0.0005175153612005218, 0.0004932123813134447, 0.0005419860384293299, 0.00043456842906439684, 0.0005369460173982624, 0.0003664763737532122, 0.00022607369035675579, 0.0003845567549842926, 0.00041641068626195837, 0.00046817111259436317, 0.0004306347683323436, 0.0004005891181501844, 0.0005427778181644802, 0.0004260997428870622, 0.0006191595949171043, 0.0005039784759282975, 0.00038689991280111655, 0.0004847693550949102, 0.0003589721846317479, 0.000409342633992966, 0.00038716807807547964, 0.000420398437909964, 0.0004445232745155467, 0.0003701607632677591, 0.0002672632969105238, 0.0004140059318003212, 0.00045976850544396754, 0.0005438739184497396, 0.0005294190467014072, 0.0005035578208551643, 0.0003970814250427969, 0.00036715521678453713, 0.00043876885780903287, 0.00048007413172196736, 0.0005541605229583185, 0.0004128647786906124, 0.0003473245515419351, 0.0005333474561263617, 0.00037689913950861433, 0.0005530264103153319, 0.000386913648471038, 0.00045342287537645566, 0.0005614869787121577, 0.0003554892933169279, 0.00038156610538147835, 0.0003714947746249783, 0.0004802974208458598, 0.00034211548423882123, 0.00040357616088400897, 0.0004621585340045536, 0.0004138907035623331, 0.00043760338721928095, 0.00026988827525152196, 0.00041762995652114005, 0.00045246231460968443, 0.0005244481462528051, 0.0004530171560581885, 0.00040242453214095513, 0.0002419289120492027, 0.0004815823486935371, 0.0004009357764422529, 0.0004171891300034429, 0.00034783346129895344, 0.0003384672205206901, 0.0004569892650260599, 0.0002664153057033883, 0.00040710673012498143, 0.0003275459589159061, 0.00035150130818314545, 0.00032743432804793136, 0.0003551330940591086, 0.0005610319809155461, 0.00041062145764711195, 0.0004516364483726682, 0.00024554003448021494, 0.00025646231798467055, 0.0003571935945758426, 0.0003719465962073665, 0.00038033617191280897, 0.00041763154501231437, 0.0004907196144842212, 0.0002828547287694165, 0.00032470855580993524, 0.0005863745928244529, 0.0003472973654533829, 0.0005367093218942025, 0.0002659396871922151, 0.0003739499652148518, 0.0004218498242967838, 0.0004251687046625409, 0.0003549590024612001, 0.0003260385597854337, 0.0003392498931537481, 0.0004744212856327029, 0.0005632772010340513, 0.0004106205797869412, 0.00043125271386491485, 0.000397301412848671, 0.00020149830172230108, 0.0001933831934891455, 0.00034389009469821787, 0.0002443254833977653, 0.00029181413451811377, 0.0003771552863222578, 0.00048794749334267793, 0.00014576075530085256, 0.00037906214207577746, 5.968153133303602e-05, 0.00031650611105789875, 0.0003660949380008519, 0.0002344045277011704, 0.00041869364019833855, 0.0004650584005241584, 0.0004443483305933685, 0.0002853573649972399, 0.0003799817319314774, 0.00032024383961330814, 0.000421835342161436, 0.00030415652888467307, 0.0004414842023769592, 0.000465485780899899, 0.0005498510281383849, 0.0003547294092533419, 0.00038302982334836904, 0.0002969483981695131, 0.00018433436082131074, 0.00048377043399116496, 0.000409870070217235, 0.0004688729871240738, 0.000412001051180278, 0.0002695470992641485, 0.00040224729204097246, 0.0003660024414908535, 0.000287458346144709, 0.00031474830726236914, 0.00029945400440142567, 0.00045642633351063134, 0.0005661658614930694, 0.0004422297416020022, 0.00023733283754232766, 0.00035528871628211895, 0.0005240269405916067, 0.000344753124738, 0.0004910776017947793, 0.0005270789418923383, 0.00033264606107805497, 0.00034313130213992326, 0.0005732874548718284, 5.511770106966185e-05, 0.0002043009467377535, 0.0005593076136690572, 0.00032236999173073034, 0.0003215702412480134, 0.00022574225764479433, 0.0003117113387775454, 0.00046732368386860255, 0.0004242603307619002, 0.0003455160671534463, 0.00023367533263978215, 0.00034353870765116163, 0.00035518172026570823, 0.00037544164618787015, 0.00043192926962321753, 0.00047848717949889035, 0.00026385317090495033, 0.0003371099097013716, 0.0002801277219493312, 0.000263118419036581, 0.00029922430798425605, 0.0002694948664315611, 0.0003451450956527472, 0.0003084359518069169, 0.0003221681451163221, 0.0004927426943693315, 0.0004023208135575836, 0.00031426426458912684, 0.0004056562640842282, 0.0001924201479313467, 0.0003281019270064641, 0.00031102898157731994, 0.0005868184291999855, 0.00027600147985488126, 0.00041434588207008656, 0.00032679458424931753, 0.0003838821202055928, 0.000254698589848675, 0.0005553788567074868, 0.0002536504458720441, 0.00022687087272336878, 0.00014582009374798999, 0.0005287147890040429, 0.0001900177425091066, 0.0002247465786449439, 0.00046546725135643155, 0.00010077277297404927, 0.00023394760905071202, 0.0003332603284001963, 0.0005044453516551002, 0.0002519366373680491, 0.00022202073935511548, 0.0003110160538230961, 0.0005648005489345642, 0.0003404925330417336, 0.00015746455332261064, 0.0003529879194489918, 0.0002628978664450803, 0.0004161721248224806, 0.00014904702547036255, 0.0002844760051473288, 0.0002414617139268484, 0.0002856259663530048, 0.0003487476974357744, 0.00041001729843102044, 0.00011869982969064866, 0.0001900656987409056, 0.00026149939678756813, 9.859116411118056e-05, 0.00031113316400930473, 0.00014616014388544688, 0.00017202334743734426, 0.00019393980341928806, 0.0004580708571104337, 0.00013638588085578064, 0.0002591957964442887, 0.00015103243400691797, 0.0005848868519705076, 0.00028956940261395524, 0.0003584921678550362, 0.00019346881792227567, 0.0002727469049485535, 0.00034973260492874485, 0.000347261958408459, 0.0004162286342354487, 0.0002645013009599788, 0.0003284012915691061, 0.0005561753070619193, 0.00033540046544619056, 0.000385136962155825, 0.000439187184278462, 0.00010721588305580638, 0.0002855605138523193, 0.00036750788591800003, 0.000422260143834295, 0.0005890587612655336, 0.00025632742821475206, 0.00035487282474804563, 0.00024198679024498956, 0.0004852083252017277, 0.00011261018855196309, 0.0003310267123897082, 4.7622105517488124e-05, 0.00030340547230564417, 0.00038573677932953767, 0.0005034987537162957, 0.00047613666461257883, 0.0001901365421671457, 0.0004006173816527008, 0.00020795277534093164, 0.0005953182329338522, 0.0003963035842122334, 0.0005344862253046106, 7.525130023812591e-05, 0.00016987067813464924, 0.00034398739376393696, 0.00017816182276368802, 0.00021846162605621485, 0.00011071194154457004, 0.00029471579041434457, 0.0001689416482072831, 0.0005235106590386146, 6.91361429852211e-05, 0.0003264865879627291, 0.00033787019630380686, 0.000144458372835925, 0.0002328631976192741, 0.0003293597830469982, 0.00034562481623761536, 0.00045867270769285975, 0.00011123546551707527, 0.00022743012504587086, 0.000243947732848329, 0.0005161740801358892, 0.0001544597401008926, 0.0002811449491496434, 0.0005205706331082447, 0.00025771047145531546, 0.0001457014340401317, 0.0001333350182161567, 0.00015490453253846936, 3.745016965786112e-05, 0.000153523350710173, 0.0001654522021763927, 3.0101599188907003e-05, 7.597455438037712e-05, 0.00018150555051756328, 0.0001714792438280893, 0.0005167626177503202, 0.00014896530063585734, 0.0006547085472530755, 0.00013064607755645737, 0.0002112807160794762, 0.0002532595569329841, 0.0003420605030016487, 0.00013641904710503077, 0.00022503738438268208, 0.0003079864683134793, 7.454296780839784e-05, 0.000308432365935107, 0.0005809686414807144, 0.0002443137509055542, 0.00034547852671000415, 0.00027003660867644223, 0.0004992134417440238, 0.0004755136566908245, 0.00017756427453527896, 0.00028203288643674853, 0.00024856833711122664, 0.00044937454740969987, 0.0005555419086714472, 0.0006059255423401778, 0.0004089780454961678, 0.00029624420380520517, 4.4909604753981315e-05, 0.00018103362516059586, 0.00028165243492492465, 0.00080693163001135, 0.00019976171785563923, 0.00022124036090737158, 0.0003073006457830564, 0.00021735768789013456, 0.0005324085424981139, 0.00017214199045062433, 0.00024545327637382457, 0.0003531159374859849, 0.00038956141954357904, 0.0005800131835296025, 0.00013674925208202791, 0.0003306923546950355, 8.321355522132788e-05, 0.0005596199009707334, 0.00014710979556347095, 0.00043872252698973126, 0.00039030170175471767, 8.311969100423628e-05, 0.0007046924706110442, 0.000309662625287033, 9.586749746053568e-05, 0.00036065409688159586, 0.00019653555727707398, 0.0003813721359676146, 0.0005486090296429864, 0.0002189680967151873], 'mse_error_last': [3.287806811757015e-08, 3.945627382344156e-13, 8.475770985120507e-09, 3.565979905527658e-05, 1.443312704800495e-07, 2.9478452136510755e-07, 4.084174488633467e-06, 2.0872149006030794e-07, 2.716402129705731e-06, 2.7811646099227164e-13, 7.036606028147768e-05, 1.5746979199776993e-10, 1.0252875269280438e-06, 2.9850397916747472e-05, 3.499228475069048e-12, 2.692480492950975e-06, 9.846877956300406e-07, 1.1846962423166893e-06, 4.6503700700944075e-07, 6.799606770912706e-06, 1.2425410922418629e-08, 2.9626046896192174e-09, 4.3492328837978976e-10, 5.062768246529268e-09, 2.0001955297368465e-07, 9.636699328547477e-07, 0.000391586221961692, 7.904253215151276e-07, 1.9289707351658356e-08, 3.966434262457259e-09, 1.1158360933163301e-13, 3.2857300033535768e-12, 0.002191006085164583, 0.00029877277322985855, 7.547075648163248e-06, 2.717086950066536e-07, 9.381210806626776e-08, 8.546558299592732e-10, 4.347735523117067e-09, 5.447241135839191e-16, 9.101089801810448e-07, 0.000569137550853956, 3.0157160633850155e-07, 6.592047760688601e-12, 5.47957882841122e-06, 5.919107377016455e-09, 9.139362974196732e-13, 4.699484185116314e-08, 2.514428110470586e-06, 1.7288036176702647e-13, 1.254916538198217e-10, 1.2505321300353752e-08, 2.63902060131015e-11, 1.96705917553311e-08, 1.2965184716199462e-09, 8.588427669557448e-09, 5.429519721574718e-05, 7.458566233419748e-12, 1.8468663717121892e-11, 2.9937692485564837e-07, 0.0010357403576488754, 4.881195546863931e-08, 4.256577032812513e-08, 1.9228092617501453e-08, 5.606837095070431e-09, 1.1930458281426655e-07, 6.04849840774588e-20, 7.944272557076728e-08, 8.352903198977993e-08, 5.894036788924832e-11, 2.1579875993313653e-08, 5.20109656435424e-07, 0.00025717278888797243, 1.1595108456397995e-10, 1.8479807790531623e-05, 3.195166121347455e-08, 1.0202867982802931e-08, 1.2435566974684999e-12, 4.509295108240448e-09, 3.5694714952262814e-06, 4.3263713365983305e-05, 1.2951863006515352e-13, 2.7624572082119065e-07, 1.3469950664923914e-10, 2.286365472570852e-08, 1.5048221363217297e-07, 1.7702788753862821e-06, 1.4424986226047993e-05, 5.60308936279901e-08, 1.6718746304706675e-07, 1.4521474642796737e-07, 1.9125397265337487e-16, 8.403370223238914e-08, 1.653001488167725e-11, 2.3598058619894017e-16, 0.0003477496947267959, 2.9757550814574583e-06, 2.6574158468331477e-09, 4.31801133512164e-09, 5.255072767283223e-11, 7.257276466264566e-05, 1.2948460780106293e-12, 6.42154352641882e-11, 4.38910265267654e-05, 4.370804813283753e-06, 0.00016508828692340474, 3.2756345506582116e-09, 0.00021896130779609026, 1.2696940544804728e-12, 5.07704531278458e-22, 2.458831017439387e-11, 1.3015516148562643e-09, 6.143546853954314e-07, 1.2290582717225785e-08, 3.305686003689673e-10, 0.00041523171207204386, 4.0033674534574785e-09, 0.0019376475854209312, 6.412624897622702e-06, 6.186669915733371e-11, 1.642026412483847e-06, 5.044379573313505e-12, 2.0461458628074243e-09, 1.929004661380844e-10, 1.1533936195175604e-08, 4.274116074887852e-08, 5.0148129716366536e-11, 1.721672838593025e-16, 3.1532548484262024e-09, 6.352355240503192e-07, 0.0003799147712227519, 0.00021823327468118426, 2.724918609891164e-05, 1.2076654469097298e-09, 6.313284551399956e-11, 1.0583409687519379e-07, 5.295475247021648e-06, 0.0006403100718169729, 6.472324195075504e-09, 1.6023663116473846e-11, 0.00029216381084928703, 2.503205548761734e-10, 0.0005985214192786218, 1.080633816491386e-09, 9.672595332667232e-07, 0.0006928734565254648, 6.376796714161828e-11, 3.7154358803126936e-10, 4.4944315395301366e-10, 5.996659218584282e-06, 2.3338820785492992e-11, 1.1658332317886958e-08, 1.8244767464354497e-06, 5.2043043104415454e-08, 2.4955266168909643e-07, 2.8193037924093992e-14, 4.864525060916816e-08, 8.155300559847273e-07, 0.00024788787447232454, 8.912723509456514e-07, 1.940813749944441e-08, 2.067048226189943e-15, 1.4446789050714843e-05, 1.4737160366369144e-08, 7.01756679166746e-08, 2.1656657021965689e-10, 8.985631803363753e-11, 1.7249344125190613e-06, 2.612684569451447e-13, 3.700422153611761e-08, 2.0581730601517316e-11, 7.180637445196949e-10, 4.956563839526298e-11, 1.4987764489225294e-09, 0.0009593760648315208, 4.9739336113967516e-08, 3.192305165925103e-06, 6.357868815961176e-14, 6.03848994581072e-14, 1.19976011699373e-09, 3.623995595906822e-09, 1.2281916960251858e-08, 1.1727805142876437e-07, 2.685301499027496e-05, 2.1873907042220745e-12, 1.478230804402302e-10, 0.0011962727860526906, 7.599236989255468e-10, 0.0003259618508721395, 1.453994739713749e-12, 9.862361365051029e-09, 4.318795738831577e-07, 3.338367899482604e-07, 3.21517634197168e-09, 3.4324865784094363e-10, 7.486678068388084e-10, 1.112217296281584e-05, 0.0007342790786951575, 1.7498453351206776e-07, 1.1867864508022607e-06, 8.745396316077148e-08, 5.6607284537636935e-15, 1.2163061684049553e-15, 1.889998625036093e-09, 4.228988663330003e-13, 3.3970330591284725e-11, 3.2364872246481775e-08, 2.463192259158208e-05, 3.53077533802743e-17, 5.175181801442896e-08, 1.6036011074654453e-24, 3.4666503166646783e-10, 2.0753003640737648e-08, 4.034106850977476e-13, 1.5538221038802899e-06, 1.5153225280360603e-05, 4.525006458669469e-06, 5.546147724043559e-11, 9.922127289629481e-08, 2.3147828854834346e-09, 9.162173705500747e-07, 4.016234035567447e-10, 4.9849229856178734e-06, 8.127875794117119e-06, 0.0005800589422556135, 1.2198187797694596e-08, 6.643514079963884e-08, 1.6157503537842245e-10, 7.23609747432269e-15, 3.8887572722073626e-05, 9.027437682756584e-07, 1.8891067341842764e-05, 1.1091464047707272e-06, 5.158164310182231e-11, 4.967615000225773e-07, 4.647110179958793e-08, 3.795565102642113e-10, 1.2897546868072545e-09, 8.86076682196531e-10, 2.0339791742161595e-05, 0.0008159153268438031, 2.7486111760898043e-06, 3.655297731788898e-12, 2.3473074977922872e-08, 0.00019152366434257474, 3.839534531103524e-08, 7.774322566533484e-05, 0.00020252641430490927, 5.793019218043422e-09, 2.153424306202393e-08, 0.0009193019613873915, 1.1318626838642848e-22, 5.109773412108666e-13, 0.0005874650107451249, 5.248096157196056e-09, 6.1418849379104115e-09, 7.400863961555774e-12, 2.052808401452867e-09, 7.343946418219191e-06, 1.1606600801370971e-06, 2.654869219305436e-08, 9.092932542029658e-12, 3.292028639934992e-08, 6.655632840572176e-08, 1.4102956262413203e-07, 4.851909465370888e-06, 5.144206544674169e-05, 1.0792890704294546e-10, 2.1049771647690714e-08, 7.718479285224654e-10, 2.8662811888863376e-10, 1.3978222548279194e-09, 2.986753958894677e-10, 5.31606397019499e-08, 4.38368269331526e-09, 1.702794719062836e-08, 7.80096644788455e-05, 1.3411212792907032e-06, 8.682826148544467e-09, 3.007426819911207e-06, 9.121520894656969e-13, 1.813937323305659e-08, 1.0447769147622175e-08, 0.0009275891131246187, 8.689672687074214e-10, 3.027047214618285e-06, 2.846157285903235e-08, 5.413098340367323e-07, 1.4958542458325608e-10, 0.0006364391169869381, 3.124544076266902e-10, 2.2489884136177832e-11, 9.21070875717484e-15, 0.00032252430776483405, 8.972620278254234e-13, 3.044555741014991e-11, 5.8435858610317365e-05, 2.3433873861414687e-16, 8.200354092115982e-11, 3.727318455258318e-08, 0.00021235280938965024, 2.5873940888927644e-10, 3.018411011416271e-11, 1.2459631962327426e-08, 0.0007983912330439719, 9.96660500971056e-08, 1.739687330943335e-13, 1.1372306483949806e-07, 6.395271071849692e-10, 5.1116222731220135e-06, 8.86908815523134e-14, 4.5803218797955506e-09, 2.779019862173935e-10, 3.812276122744424e-09, 1.801274971982778e-07, 2.995689439611615e-06, 4.585266181865767e-15, 5.091198871187805e-12, 1.397222645996513e-09, 7.376425542690248e-16, 2.322059036659243e-08, 2.0938663457627997e-13, 1.1709097129213665e-12, 6.609072907748888e-12, 3.4827980297187755e-05, 6.352479557297379e-14, 1.8506693051849351e-09, 4.892122270724634e-13, 0.0010963127989251369, 1.0188939675464824e-08, 2.5129766399793766e-07, 2.667093876706298e-11, 1.8519086728336602e-09, 1.4256929197502797e-07, 3.3510988718592125e-07, 5.680454931788119e-06, 1.3101988493375635e-09, 7.372365894655826e-08, 0.0009256418566043562, 1.780681792637468e-07, 1.4965487989261619e-06, 1.9798689636260654e-05, 7.094246543812741e-15, 1.1548041569223672e-08, 8.140689988394089e-07, 8.205841276821068e-06, 0.0009839887895648476, 1.4953029273470841e-09, 7.492618462080048e-07, 1.867244726433662e-09, 0.00018455918371737705, 1.2224295271546084e-14, 2.2202307361292331e-07, 9.98219843616936e-19, 3.147209181054101e-08, 3.324336540816189e-06, 0.00017409385387488554, 0.00010219450226311733, 3.31054162517989e-11, 5.204930377488526e-06, 1.8062127134397314e-10, 0.0011950037713024332, 6.127424499582621e-06, 0.00028872786500399607, 1.6660385445740052e-16, 1.707780250015572e-11, 3.8056031733248346e-07, 2.241183648268349e-11, 5.267868197496036e-10, 1.1917414255525315e-13, 4.332888465510437e-08, 7.73114492091818e-12, 0.0003517945463538282, 1.1862780405296587e-16, 1.557617406370498e-07, 2.169871655450448e-07, 7.182860257124418e-13, 1.89373009815254e-09, 2.2748386723387206e-07, 3.1078896875751497e-07, 7.350623369207316e-05, 4.0190367310238875e-14, 6.057334857743309e-10, 4.084154322240328e-09, 0.00014322319663622815, 4.5614671599966735e-12, 3.2893306462284325e-08, 0.00025113911898729766, 5.08395929969555e-09, 2.024226663204474e-12, 7.016137131300849e-13, 5.156916447690803e-12, 6.502639452049721e-19, 7.285823823321273e-12, 2.1674705891872725e-11, 5.333690611294211e-20, 5.040026205228493e-15, 4.585851607005293e-11, 8.246886723127956e-11, 0.0003723462669760496, 3.990247507792199e-12, 0.00156705001117692, 1.3758010634223755e-12, 1.0299628400810168e-09, 8.933225377705857e-09, 8.901580469544122e-07, 2.217327159404894e-12, 1.5508967158087033e-09, 2.236883507333756e-07, 2.9624387190639277e-15, 6.748344960228655e-08, 0.0004943009856952753, 4.70617692375856e-09, 1.4891720593185687e-06, 9.915030651935955e-09, 0.0001510106212081118, 7.762453865979827e-05, 5.311837414232963e-11, 4.954958518433628e-08, 5.009504582947807e-09, 6.943218116842035e-05, 0.0006041056391221985, 0.0008095591362145966, 8.189362198498396e-06, 6.25167440199726e-08, 8.279906516510467e-18, 1.586859493231418e-10, 4.7678515159203866e-08, 0.0021097718537092863, 6.983635371791894e-10, 2.0009595437204914e-09, 4.7632839490376444e-07, 1.2532618741358848e-09, 0.00037695309555736814, 4.2639987385369605e-11, 7.580770605793608e-09, 1.4877672495958344e-06, 9.95942482387738e-06, 0.0008082842918102994, 4.006912671033555e-12, 5.380535232480569e-07, 2.1782787478020208e-14, 0.000686720219645657, 1.6030716759180468e-11, 5.602760870599262e-06, 5.146229557973095e-06, 1.6504145067743444e-14, 0.0019324516597354524, 3.813252266580312e-07, 9.676425333730414e-14, 1.918018516455246e-06, 2.4026949754555214e-10, 7.434335512721491e-06, 0.0005008379074111018, 4.638714920652088e-09], 'logloss_error_first': [0.0015234003968350445, 0.0015233738405423319, 0.0015233447762089492, 0.0015233812714497469, 0.0015233214874565216, 0.0015233490585480228, 0.001523341549761037, 0.0015233000037057794, 0.0015233209082482952, 0.0015231124940479628, 0.0015233515107079233, 0.001523141223832112, 0.0015232662917092437, 0.0015233253246701155, 0.001522973133018776, 0.001523251649928762, 0.0015232138855637229, 0.001523201194825255, 0.001523160432892891, 0.0015232168578249371, 0.001523027453862033, 0.0015229500978430302, 0.0015228602699984917, 0.001522904084789044, 0.0015230067470248631, 0.0015230410071083882, 0.0015233040161669337, 0.0015230069644800585, 0.0015230623065452455, 0.0015227791360777766, 0.0015223074002725526, 0.0015223735689530468, 0.001524128437545067, 0.0015232580361666602, 0.001523033402016316, 0.0015228520545722973, 0.0015230496461757803, 0.001522540100731408, 0.0015225668225507265, 0.0015219819234424923, 0.001523039429470259, 0.0015232927815016764, 0.0015227613097107968, 0.0015223038965072133, 0.0015228853054912144, 0.0015227298639085402, 0.0015220295739843317, 0.0015226892851485528, 0.0015227932962377907, 0.0015217194515481924, 0.001522064444988134, 0.0015223914265868103, 0.001521799546624758, 0.0015223372643226808, 0.0015220776530113329, 0.0015223068234881787, 0.0015232247106755272, 0.0015215605171710334, 0.0015216503048639581, 0.0015225222323004188, 0.0015236623280605898, 0.0015222393912132585, 0.0015222197687266798, 0.0015221195958456755, 0.001522163953699453, 0.0015223825915319667, 0.0015193724659199653, 0.0015221758558402513, 0.0015222475145829735, 0.00152162322496333, 0.0015220396845244469, 0.0015223107267497277, 0.001523236150563094, 0.0015213582370443958, 0.0015230119193372547, 0.0015219193981981273, 0.0015218296439157544, 0.0015205836445600842, 0.001521500769917492, 0.0015224982438375777, 0.0015228156396699657, 0.001520220069117461, 0.0015226054376794391, 0.0015211581809429142, 0.0015219738588987996, 0.0015222053764901303, 0.0015222878360682008, 0.0015226031129102512, 0.001521709272410936, 0.0015219943858522397, 0.0015218661915817576, 0.0015189931738554391, 0.0015217302571296045, 0.0015204307179893263, 0.0015188254927842257, 0.0015233613543587496, 0.0015222924415062631, 0.0015212109386966816, 0.0015211074158933975, 0.0015204780935180527, 0.0015227241810493938, 0.0015199992747022921, 0.001520485711109827, 0.001522756138635128, 0.0015223162641678993, 0.0015232381874250701, 0.001521044479050845, 0.0015231830050895466, 0.0015195254690907108, 0.0015154772472154073, 0.0015199085894539973, 0.0015206492606068185, 0.0015217826734002405, 0.001520964304822024, 0.0015202818386006141, 0.0015232298299459976, 0.0015207984948132358, 0.0015247005206987308, 0.0015224746223485362, 0.0015198888321175043, 0.0015220768955216118, 0.0015192585147013574, 0.001520464613088663, 0.001519942574494359, 0.0015207091068633516, 0.0015212099200119815, 0.001519464148432256, 0.0015166357448680905, 0.0015204966449974113, 0.0015215038395764813, 0.001523328039462772, 0.0015229604034443088, 0.0015224410790971319, 0.0015201555721294003, 0.0015194232452076094, 0.0015211070223988903, 0.0015220095532314604, 0.001523525864746502, 0.0015205315668997484, 0.0015188361056467016, 0.001523043657786991, 0.001519661540893046, 0.0015235079456669036, 0.0015198986532767294, 0.001521422345157828, 0.0015236081042384329, 0.0015190348790410006, 0.0015197090523456811, 0.0015194306825304295, 0.0015219413653719189, 0.0015187492596638187, 0.001520274800840339, 0.0015216124703961486, 0.001520438071201591, 0.0015210693608307955, 0.0015165985501535374, 0.0015206037991409422, 0.001521403072183964, 0.0015228366360304758, 0.0015213312626370626, 0.0015201611213159572, 0.0015156475110406269, 0.0015220219400978647, 0.0015202000072947856, 0.0015205840918388522, 0.0015187621423338822, 0.0015185019344413754, 0.0015214956649431098, 0.0015163630369386674, 0.0015202344161462035, 0.0015183079236251536, 0.0015189124714452605, 0.001518275032652551, 0.001518891125301858, 0.001523571787327787, 0.0015204129518964088, 0.0015212435634253236, 0.0015156260101870508, 0.0015161009275643878, 0.0015190371658846138, 0.0015194249661503818, 0.0015196249680979853, 0.0015205587040520965, 0.00152221195066158, 0.0015169130456938104, 0.0015181292418789305, 0.0015242066423888556, 0.001518761163511701, 0.0015230862634513821, 0.001516219234885954, 0.0015194417552265587, 0.0015206264816159888, 0.0015207223545743692, 0.0015189370718014657, 0.0015181395599357431, 0.0015185153132665592, 0.0015218547528826046, 0.001523748076949043, 0.0015203694024763302, 0.001520722904585724, 0.0015200318212441244, 0.0015138399487839337, 0.0015135997364931388, 0.0015186018832215819, 0.0015155037534368466, 0.0015169418321816061, 0.0015194697838462551, 0.0015220266863934843, 0.0015110570029253066, 0.001519335642374135, 0.0015043987168535011, 0.0015176887917478146, 0.0015190876672258684, 0.0015147630614707132, 0.0015202209842846192, 0.0015215709603005063, 0.0015210820947092508, 0.0015166829603849264, 0.0015194293905007427, 0.001517516073568095, 0.001520544624409049, 0.0015170651659999416, 0.0015210047006533327, 0.0015214570752815932, 0.00152349896250768, 0.001518782504468521, 0.0015195716398392284, 0.0015170838290532083, 0.0015128368420977549, 0.0015220429842240217, 0.0015202040073889439, 0.001521466954440443, 0.001520045706017605, 0.0015160988696156427, 0.0015200240409951134, 0.0015190548215916445, 0.0015164483509751948, 0.0015175833221782783, 0.0015168386085356715, 0.001521314756731103, 0.0015236440314815478, 0.001520893909218387, 0.001514957944068496, 0.001518763139660834, 0.0015227713520102478, 0.001518174453368019, 0.001522168944807809, 0.0015230252927574803, 0.0015181024731964724, 0.0015183649839279416, 0.0015240134577922493, 0.0015031923010619735, 0.0015131912713093275, 0.0015237833627599826, 0.0015177030978126812, 0.001517663003531718, 0.001514009841586273, 0.0015173964764301374, 0.001521462115545991, 0.0015203825587736103, 0.0015184047630171344, 0.0015146495833091853, 0.0015183035328481423, 0.0015186580482666604, 0.001519278555112284, 0.0015207476801285859, 0.0015216348033474183, 0.0015157764568272916, 0.0015181441280942704, 0.0015160482197362837, 0.0015153843885420653, 0.0015169869804710166, 0.0015159292282907275, 0.001518339646500471, 0.001517234764685407, 0.001517621780858415, 0.0015219679350248403, 0.0015199429711060199, 0.0015173883643208907, 0.0015199756385123418, 0.0015128396100572053, 0.0015178193142898738, 0.001517256860285915, 0.0015241236492659026, 0.0015161114788606641, 0.0015202516420560633, 0.0015177524459265151, 0.0015194623480274628, 0.0015153966577003395, 0.001523379468080435, 0.001514973304729164, 0.0015142931058930364, 0.001510165763119825, 0.0015227712225540859, 0.0015126858140143327, 0.0015141157756705416, 0.001521492211322157, 0.0015068993848439361, 0.0015144145856671887, 0.0015176089067353614, 0.0015224446252386017, 0.0015151403623998782, 0.0015136346547357398, 0.001517195215616799, 0.0015235613003028619, 0.0015180847188984755, 0.001510517548604127, 0.0015185222694708209, 0.0015155231678054294, 0.00152023467318555, 0.0015103291417393329, 0.001516203024100065, 0.0015146127394263626, 0.0015159676060946625, 0.0015183114088051463, 0.0015197985369034427, 0.0015080141828034336, 0.0015123879299268346, 0.0015149926323790527, 0.0015062994496767654, 0.0015170868117454685, 0.0015095340241115516, 0.0015110022628980126, 0.0015125058336424371, 0.0015213342319463483, 0.0015088654147857945, 0.0015146923585651066, 0.001510074196603196, 0.0015243734014149433, 0.00151626098267167, 0.001518579443439853, 0.001511833286231037, 0.0015152975847062238, 0.0015179166991154398, 0.0015176944766360852, 0.0015202347059658052, 0.0015154318994670395, 0.0015176085315177358, 0.0015236783418925623, 0.0015177738584638346, 0.001519350563144189, 0.0015208462751378413, 0.0015066907710553656, 0.0015160963625739348, 0.0015188012757429274, 0.0015204263126237536, 0.0015240961003314445, 0.0015145414568423759, 0.0015183572126730531, 0.0015143288133244465, 0.0015214554435802735, 0.001507504412059364, 0.0015175824612075704, 0.0014998855469817755, 0.0015166999915069688, 0.0015192651515107268, 0.001522542194390611, 0.0015217940167789581, 0.0015120154568639983, 0.0015197334414352498, 0.0015128195271229415, 0.001524729330765104, 0.0015189682826642615, 0.0015228136690107902, 0.0015033429160301842, 0.00151078405551328, 0.0015173915008355405, 0.0015107026880512662, 0.0015131798157469818, 0.0015062381872341913, 0.0015162567960575633, 0.001510121214661497, 0.001522409502243177, 0.0015024012754307483, 0.001517399004740556, 0.0015178218194878987, 0.0015093298491950131, 0.0015130775714984016, 0.001517456162331717, 0.0015180696591715198, 0.0015212961557630167, 0.0015069224332611424, 0.0015129031862623381, 0.0015141581865846135, 0.0015223645748004347, 0.00150914089856786, 0.0015149674498632902, 0.001523042877866342, 0.001514818211463972, 0.00150923880040689, 0.0015083734214874714, 0.0015090500456102645, 0.0014968717849569758, 0.0015094872093321678, 0.0015101715419956216, 0.0014949805293100974, 0.0015021200441933935, 0.0015110252399337682, 0.001509522682236837, 0.0015220827819676485, 0.001509073524604779, 0.001525634202262724, 0.0015069876709012343, 0.001511568091918832, 0.0015135685761351867, 0.0015176337672639113, 0.0015073879338892994, 0.0015130436567784345, 0.0015156310258756908, 0.001501882419587172, 0.0015166059906152418, 0.0015240381125561826, 0.001513911188305067, 0.0015176679985601362, 0.0015144400380551722, 0.001521741886577195, 0.001521073833378377, 0.0015106709663091065, 0.0015154069539186745, 0.0015133695107780365, 0.0015209232751339184, 0.0015239370598726066, 0.0015254279433934528, 0.0015199160040492321, 0.0015153097466138283, 0.0014975132881629286, 0.001510683750549295, 0.0015154133302617886, 0.0015292043298076273, 0.001511606505916653, 0.001512738494676759, 0.0015161282892638653, 0.0015125991222108203, 0.001522571410872539, 0.0015102923732418488, 0.0015130476867369345, 0.0015179957203935244, 0.0015183034780378018, 0.0015245720000270696, 0.0015079636609056349, 0.0015172064927667032, 0.001502441937670564, 0.0015240464105194251, 0.0015085337701091347, 0.001520275467421626, 0.0015192933351014278, 0.0015032674713348253, 0.0015267168562242174, 0.0015162913458764342, 0.0015044632472619676, 0.0015173825585052443, 0.0015115537723872341, 0.0015179731210517133, 0.0015230149119716673, 0.0015123718291627987], 'logloss_error_last': [0.00020978530635112937, 2.0194054334952113e-05, 0.0001676773394993022, 0.0008384021169670378, 0.00028497327201385935, 0.0003654203953882387, 0.0005675641742967892, 0.0002811744163391883, 0.0005071064619957113, 2.458227587919548e-05, 0.001061264562148203, 8.250951628362739e-05, 0.00040361616996438803, 0.000785127450946274, 3.756992232759174e-05, 0.0005555726119569959, 0.00040448551759899557, 0.000433554201814113, 0.0003825499847921096, 0.0006127273999459611, 0.00016414042382830905, 0.00013317067877506228, 9.462477462145791e-05, 0.00015276862266716342, 0.0003157957266485935, 0.0004368364862662239, 0.0013193441561650775, 0.00039961193748981025, 0.00019206393611288005, 0.00014976209799393554, 1.8576813375271446e-05, 3.5338803349024875e-05, 0.00575615258348561, 0.0013110196050876795, 0.0006311947423785505, 0.00032088539241973324, 0.0002649774353002637, 0.000103304925951682, 0.00012777937962502742, 6.6132158904818045e-06, 0.00040605496234636756, 0.001464567149877352, 0.00033115849771411197, 4.128747094178543e-05, 0.0005286307878211744, 0.000177057738233533, 2.8309552887520488e-05, 0.00023660445263798985, 0.00044344075283511014, 2.00605258085123e-05, 7.33112735844042e-05, 0.00018285719086864752, 4.938154358294744e-05, 0.00019047257049079603, 0.00011245353207135723, 0.0001597926961198958, 0.0009741594918361163, 4.058270112651556e-05, 5.3042280052160266e-05, 0.00034789668752146743, 0.00198141179321134, 0.000216301123647949, 0.00021702132603099056, 0.00018695718884936761, 0.00015798110682379194, 0.0002987493578294071, 9.196138057862581e-07, 0.0002474328285143101, 0.0002721588692930473, 7.585187608600969e-05, 0.0002088696508061831, 0.00034833160238418405, 0.0012903937898556736, 7.470721229448368e-05, 0.0008138689270133023, 0.0002044067007779345, 0.00018064055315998391, 2.7083774194392505e-05, 0.00012907080939045888, 0.0005419501002092794, 0.0008565447115919178, 1.9072302219458775e-05, 0.00044940924354804795, 6.792590894248325e-05, 0.000228135113761492, 0.00032756366197709885, 0.00044598507359366575, 0.0006703639975733745, 0.00022054425338402858, 0.0003172052128391093, 0.0002823433969676773, 4.718046912805218e-06, 0.0002533695883772441, 4.928031772639033e-05, 5.32522374207481e-06, 0.0013804105974993218, 0.0005219617265359577, 0.0001474156993571108, 0.00014022495142865428, 6.705391098393657e-05, 0.0008869751248837809, 3.287706087933044e-05, 6.534781596217704e-05, 0.0008218216915016385, 0.0005758836869322322, 0.0012532558498802892, 0.00014065243897361831, 0.0012788354497875933, 2.9253908720383615e-05, 3.3591396680530126e-07, 5.36257156322053e-05, 0.00012023461575357136, 0.00038310363494806747, 0.0001765376547901449, 9.119812040110741e-05, 0.0013080911446974898, 0.00014740835804096994, 0.0032997976221735377, 0.0007127918511859875, 6.568295852692339e-05, 0.0005345812656715765, 3.674036503787554e-05, 0.00012238239952235507, 7.752215315582802e-05, 0.00016404058156525367, 0.0002652564382558322, 5.756843385829204e-05, 4.66076901971279e-06, 0.0001655525922540206, 0.0004038159863215226, 0.001357968123600897, 0.0012135117326165185, 0.000849969617860503, 0.00011280004095847076, 6.230898907731879e-05, 0.0002635345794022696, 0.0005441347111411183, 0.0015602301679232067, 0.0001707247604923116, 4.7912509113224585e-05, 0.0012885342332171917, 8.755230359999908e-05, 0.0015376742094171982, 0.00011042155303328512, 0.00037432916906215014, 0.001774166336639371, 6.466465092694875e-05, 0.00011618469746470224, 9.822214193922818e-05, 0.0006624378646536931, 4.953808272637335e-05, 0.0001650314623555043, 0.00044760957939588166, 0.00023155526210866752, 0.0003091758022919503, 1.3435552346540031e-05, 0.00022838121516539304, 0.0004052092899666831, 0.0011979203842474298, 0.0004697604413897281, 0.00021475930613397756, 8.43269628140813e-06, 0.0006132477125665207, 0.00018386569460072458, 0.00024374557895918497, 8.898963745177214e-05, 7.766553487680582e-05, 0.0004525943307605522, 1.8920839437337856e-05, 0.00026731666119980967, 5.640160720484268e-05, 8.915074005651792e-05, 5.9577550370210536e-05, 0.00012310186422481313, 0.0018430638344559597, 0.0002433330730356347, 0.0005489420794335669, 1.6029889315521627e-05, 1.6231890318131913e-05, 0.00011098629295784543, 0.00014320163840076744, 0.00016705954366932907, 0.0002917704960851704, 0.0007573851122035061, 3.249026445891807e-05, 7.206034007987177e-05, 0.0019607798233428723, 0.00010705344068816248, 0.0014315853150065156, 3.059266095264561e-05, 0.00016789120287620716, 0.00033732238939267845, 0.00035345877683680605, 0.00013139810564358892, 8.414588135129293e-05, 0.00010569496161706208, 0.0006729031826565304, 0.0016406178538885148, 0.00030977674052542293, 0.00044949654242824665, 0.00026234475354899926, 9.193565967225198e-06, 7.062075162231443e-06, 0.00012583636228814395, 2.289397440844582e-05, 6.199571486413534e-05, 0.00021325530540205296, 0.0008915695855941796, 2.7330539478432324e-06, 0.0002545790324438946, 8.76813265658286e-08, 9.079465686920623e-05, 0.0001917438402464512, 2.5996344977852745e-05, 0.00044607328258606914, 0.0006494373948283936, 0.0005221332420918708, 5.990998861767615e-05, 0.00024591088198214304, 0.00012425436709846113, 0.00041222811594448426, 9.808863474909645e-05, 0.000525062799620314, 0.0007376476627587244, 0.0014510219973835037, 0.00018148618314796586, 0.00026357308657703766, 8.027705816124675e-05, 1.0334171019259885e-05, 0.0008247080519885206, 0.0003852713423057766, 0.000781551328993032, 0.00043721270517966664, 5.668930086410804e-05, 0.0003553430299886061, 0.0002310507280198169, 8.793604652549137e-05, 0.00011732990515866375, 0.00010811378001750636, 0.0006684132401536267, 0.0017882473811885891, 0.0006001273048978551, 3.60029440037474e-05, 0.00020874763423835897, 0.0012971625552443897, 0.00021675279360845257, 0.0009035225399489323, 0.0012123484715579362, 0.0001603318926135052, 0.00018927874965173115, 0.0017376511633156663, 2.3327238613994662e-07, 2.50083497796592e-05, 0.0015556786607080384, 0.00014835251495730648, 0.00014945350275227137, 3.90514912233856e-05, 0.0001306186385075629, 0.000779692221774478, 0.0005292883539213282, 0.00020613461397345033, 4.2174026184180434e-05, 0.00020713630473674543, 0.00023982406305847828, 0.00030199530345530445, 0.0005545143549391205, 0.0009054591939198414, 7.265522968901327e-05, 0.0001987367025536172, 0.00010254430624669855, 8.287854662699949e-05, 0.00012430044651427235, 8.428570880697371e-05, 0.00022884261915558275, 0.00014647276701088875, 0.00017776117847012504, 0.0010332131755923218, 0.00043455175778981693, 0.00016329179740656095, 0.00046157698990838676, 2.656320801329761e-05, 0.000198320121772539, 0.00016402527770785692, 0.001937906251591113, 0.0001035233940667467, 0.0005076839013234518, 0.00020239758059319605, 0.0003771556448708057, 7.884595831001799e-05, 0.00160444927678889, 8.440957893302067e-05, 5.3045435445297026e-05, 1.245534593220382e-05, 0.0013603714295935983, 2.901496754698459e-05, 5.3799492530674636e-05, 0.0008243004095239532, 4.4252251328977835e-06, 6.435487345075979e-05, 0.00024409272281183218, 0.0011134393258808515, 8.451994576337843e-05, 5.812237356734257e-05, 0.00018327102018821169, 0.0017201742961408767, 0.00025967007216001883, 1.976829724297985e-05, 0.0002920060433279794, 0.00010318471381507331, 0.0005568439573955918, 1.6387678814127668e-05, 0.00014340955567363652, 8.203694397801321e-05, 0.0001510332300705574, 0.00029809739014666794, 0.0005488724709687879, 9.498132369233822e-06, 3.834436644158794e-05, 0.0001193195545310481, 6.070807656636289e-06, 0.00020339559437999776, 1.964248871588454e-05, 3.200293651054357e-05, 4.286088972773316e-05, 0.0008017803572698704, 1.659814007883916e-05, 0.00012649281038223657, 2.175682043464655e-05, 0.0018314614486170384, 0.0001689695938226541, 0.0003432197698029531, 5.134504139577244e-05, 0.00014600953120330086, 0.00033670826368726296, 0.00034914297576403835, 0.0005803015876754035, 0.00012606311326019467, 0.0002635345221358478, 0.001573633122008891, 0.0002916905487691673, 0.00045729500395119384, 0.0007188606802768063, 9.750322458262608e-06, 0.00017461708269052122, 0.00040069472874947753, 0.0006308752654970078, 0.0018999559176801366, 0.00013046724574798267, 0.00036584121656081593, 0.00011018220260113393, 0.0010841113960150634, 1.1531252458466221e-05, 0.0002957465947815158, 1.4449864086810782e-06, 0.0002189075198160359, 0.0004908386687705219, 0.0011384879030508256, 0.0009722225181790856, 5.458018662777076e-05, 0.0005589847820854501, 7.339881466652204e-05, 0.001942628540335957, 0.0005642847400322173, 0.0013812325864024173, 4.7603149932854734e-06, 4.2839293219074165e-05, 0.00035835492634366564, 5.037581646988456e-05, 8.957419647959877e-05, 1.5062955447668229e-05, 0.00021879693352760656, 4.5025617190154246e-05, 0.0013583486166290537, 4.364179880051225e-06, 0.0002949649619977162, 0.00032446907848134986, 2.7626118539027616e-05, 0.00011939877890215337, 0.0003118716551662776, 0.0003532108892049776, 0.0008926015108459074, 1.4816666956248275e-05, 0.00010893331286066212, 0.00013494110383433435, 0.0012336045958051762, 3.870324050781085e-05, 0.00021712779469541438, 0.0012544566180841294, 0.0001539755251917328, 3.220570951551899e-05, 2.6069182340506813e-05, 4.120377772087294e-05, 1.4081185934896985e-06, 3.938085695707573e-05, 4.851076312171508e-05, 8.696986617018658e-07, 7.849295056182853e-06, 6.117705642987659e-05, 5.9299529854519326e-05, 0.0013366501495594588, 3.7011011074764703e-05, 0.0024802811900902686, 2.9441285084680375e-05, 0.00010760308247971825, 0.00017208099628097747, 0.00038205387384365703, 3.367668183351691e-05, 0.00011694646975665316, 0.00031173235697726253, 8.200768744140627e-06, 0.00026869378529712553, 0.0017230069588047437, 0.0001467888321540745, 0.00040595108424857637, 0.0001986501737636623, 0.0011948689254727555, 0.0010535856237095986, 6.294381455152524e-05, 0.00022503673594750229, 0.00017374449704603788, 0.0008558527940292877, 0.0015086837813402128, 0.0018267967765365446, 0.0006331412267257104, 0.00027596081559079174, 2.9523463231317684e-06, 7.161856484288053e-05, 0.00022857941739811853, 0.003980252034871689, 9.38586140961911e-05, 0.0001209678710093661, 0.0003119336852593936, 0.00011544701665661156, 0.0014358139134391713, 6.227060610633682e-05, 0.00017709281223565735, 0.0004345008232166506, 0.0006368062914278314, 0.001700005931608288, 3.6991274660716024e-05, 0.0003664253288046321, 1.3371735702402839e-05, 0.0015612269464980268, 4.6260120356759445e-05, 0.000775122008981778, 0.000572438615783536, 1.225534422262342e-05, 0.002952963705648301, 0.00031860542788857545, 1.7166940418418426e-05, 0.0005095969117210861, 9.167345383705244e-05, 0.0006118561483731561, 0.0015599776201566623, 0.00013150139158566042]}


def remove_empty_lines(string):
    # removes empty lines from the string
    # returns a list splitted by \n separator
    string_splitted = string.split("\n")
    string_splitted_with_no_empty_lines = [line for line in string_splitted if line.strip() != ""]
    return string_splitted_with_no_empty_lines


class LogisticRegression(StageTest):

    def generate(self) -> List[TestCase]:
        return [TestCase(time_limit=1000000)]

    def check(self, reply: str, attach):

        # TESTS FOR OBJECTIVES 1-12

        reply = reply.strip().lower()

        if len(reply) == 0:
            return CheckResult.wrong("No output was printed")

        if reply.count('{') != 1 or reply.count('}') != 1:
            return CheckResult.wrong('Print output as a dictionary')

        index_from = reply.find('{')
        index_to = reply.find('}')
        dict_str = reply[index_from: index_to + 1]

        try:
            user_dict = ast.literal_eval(dict_str)
        except:
            return CheckResult.wrong(f"Seems that output is in wrong format.\n"
                                     f"Make sure that you use only the following Python structures in the output: string, int, float, list, dictionary.")

        if not isinstance(user_dict, dict):
            return CheckResult.wrong('Print output as a dictionary')

        if len(user_dict.keys()) != 7:
            return CheckResult.wrong(
                f'Wrong number of keys in output dictionary: 7 expected, found {len(user_dict.keys())}')

        accuracy_keys = {'mse_accuracy', 'logloss_accuracy', 'sklearn_accuracy'}

        if not accuracy_keys.issubset(user_dict.keys()):
            return CheckResult.wrong(f"Wrong accuracy keys in the dictionary output.\n"
                                     f"The following keys are expected: {', '.join(str(x) for x in accuracy_keys)}")

        error_keys = {'mse_error_first', 'mse_error_last', 'logloss_error_first', 'logloss_error_last'}

        if not error_keys.issubset(user_dict.keys()):
            return CheckResult.wrong(f"Wrong error keys in the dictionary output.\n"
                                     f"The following keys are expected: {', '.join(str(x) for x in error_keys)}")

        PERCENT_ERROR = 0.02
        ERRORS_ARRAY_LENGTH = 455
        # check the accuracy values and only the length of error arrays, not error values
        for key, user_value in user_dict.items():
            if key in accuracy_keys:  # dict value should be a single number

                if not isinstance(user_value, float):
                    return CheckResult.wrong(f'Print {key} value as a float')

                if not answer_dict[key] * (1-PERCENT_ERROR) <= user_value <= answer_dict[key] * (1+PERCENT_ERROR):
                    return CheckResult.wrong(f'Wrong {key} value')
            elif key in error_keys:  # dict value should be an array
                try:
                    if len(user_value) != ERRORS_ARRAY_LENGTH:
                        return CheckResult.wrong(f'Wrong length of {key} array')
                except TypeError:
                    return CheckResult.wrong(f'Wrong data type of the value corresponding to \"{key}\" key. It has to be an array.')

        fig, axs = plt.subplots(nrows=2, ncols=2, figsize=(20, 10))
        axs[0, 0].plot(answer_dict['mse_error_first'])
        axs[0, 1].plot(answer_dict['mse_error_last'])
        axs[1, 0].plot(answer_dict['logloss_error_first'])
        axs[1, 1].plot(answer_dict['logloss_error_last'])
        axs[0, 0].set_ylabel('Squared Error')
        axs[0, 0].set_title('MSE: First Epoch Errors')
        axs[0, 1].set_ylabel('Squared Error')
        axs[0, 1].set_title('MSE: Last Epoch Errors')
        axs[1, 0].set_ylabel('Log Loss')
        axs[1, 0].set_title('Log-loss: First Epoch Errors')
        axs[1, 1].set_ylabel('Log Loss')
        axs[1, 1].set_title('Log-loss: Last Epoch Errors')
        plt.savefig("graph.jpg")

        # TESTS FOR QUESTIONS 1-6

        answers2questions = [(0, 0.0001), (0, 0), (0.00152, 0.00153), (0.00550, 0.00600)]
        if len(reply) - len(dict_str) == 0:
            return CheckResult.wrong("Great, you cracked the hardest part!\n"
                                     "Now you can find graph.jpg in the current directory.\n"
                                     "Examine error visualizations and answer the questions from the Objectives.")

        num_of_lines_in_output = len(remove_empty_lines(reply))
        if num_of_lines_in_output < 8:
            return CheckResult.wrong(f"Find graph.jpg in the current directory, examine error visualizations, and answer the questions from the Objectives.\n"
                                     f"Including answers to six questions, there is not enough lines in your output. Expected at least 8, found {num_of_lines_in_output}.")

        if "answers to the questions:" not in reply:
            return CheckResult.wrong(f"Find graph.jpg in the current directory, examine error visualizations, and answer the questions from the Objectives.\n"
                                     f"Didn't find \"answers to the questions:\" substring in the output of your program. Provide the answers in the correct format.")

        reply_split = reply.split("answers to the questions:")
        if len(reply_split) < 2:
            return CheckResult.wrong(
                f"Find graph.jpg in the current directory, examine error visualizations, and answer the questions from the Objectives.\n"
                f"Seems like you didn't provided any answers after 'answers to the questions:' substring :(")

        user_answers2questions_str = reply_split[1].strip()  # take everything after 'answers to the questions' substring
        user_answers2questions_list = remove_empty_lines(user_answers2questions_str)

        if len(user_answers2questions_list) != 6:
            return CheckResult.wrong(f"There should be exactly 6 lines with answers to the questions\n"
                                     f"after \"answers to the questions\" substring. Found {len(user_answers2questions_list)} line(s).")

        for i, line in enumerate(user_answers2questions_list[:4]):  # check first four answers, which are numerical
            line = line.replace(" ", "")
            user_answer_match = re.search(r"[1234]\)([+-]?(?:[0-9]*[.])?[0-9]+)", line)
            if user_answer_match is None:
                return CheckResult.wrong(f"Cannot find a numerical answer to the question #{i+1}.\n"
                                         f"Note that you should present it in the following format: {i+1}) <your answer>.\n"
                                         f"Check the Example section for the correct format.")
            else:
                user_answer = float(user_answer_match.group(1))
                answer = answers2questions[i]
                if not answer[0] <= user_answer <= answer[1]:
                    return CheckResult.wrong(f"Answer to the question #{i+1} is wrong")

        for i, line in enumerate(user_answers2questions_list[4:]):  # check the last two answers, which are strings
            line = line.replace(" ", "")
            user_answer_match = re.search(r"[56]\)([a-z]+)", line)
            if user_answer_match is None:
                return CheckResult.wrong(f"Cannot find an answer to the question #{i+5}.\n"
                                         f"Note that you should present it in the following format: {i+5}) <your answer>.\n"
                                         f"Check the Example section for the correct format.")
            else:
                user_answer = user_answer_match.group(1)
                if "narrowed" in user_answer or "expanded" not in user_answer:
                    return CheckResult.wrong(f"Answer to the question #{i+5} is wrong")

        return CheckResult.correct()


if __name__ == '__main__':
    LogisticRegression().run_tests()